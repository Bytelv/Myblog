!function(){"use strict";var t;!function(t){function e(t,e,s){const n=t[e];if(!n)return!1;const i=s(n);return t[e]=i,!0}t.func=e,t.prop=function(t,s,n,i){const a=Object.getOwnPropertyDescriptor(t,s);return!!a&&(n&&e(a,"get",n),i&&e(a,"set",i),Object.defineProperty(t,s,a),!0)}}(t||(t={}));const e=location.href,s=location.host,n=location.origin,i=n+"/",a=new URL("freecdn-internal/0.4.1",i).pathname,r=/\.(?:jpg|jpeg|png|apng|gif|ico|bmp)$/i,o=fetch,c=new Uint8Array(0),l=crypto.subtle;let p;class h extends Error{constructor(t){super(t)}}class u{onRequest(t,e){}onResponse(t,e,s){}onData(t){return t}onEnd(t){return t}onError(t){}onAbort(t){}}var d;!function(t){let e;t.set=async function(t){const s=ct(t);s&&(e=await l.importKey("spki",s,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]))},t.verify=async function(t){if(!e)return!1;const s=t.lastIndexOf(10),n=rt(t.subarray(s+1)).match(/# SIGN: ([A-Za-z0-9+/=]{88})$/);if(!n)return!1;const i=ct(n[1]),a=t.subarray(0,s);return await l.verify({name:"ECDSA",hash:{name:"SHA-256"}},e,i,a)}}(d||(d={}));const m=/^(?:\/|https?:|@).*/gm;class f{constructor(){this.urlFileMap=new Map}has(t){return this.urlFileMap.has(t)}get(t){return this.urlFileMap.get(t)}getParams(t){const e=this.get(t);if(e)return e.parse(),e.params}async parse(t){this.parseFile(t+"\n@__default__\n expires=30s\n mime=auto\n open_timeout=10s\n valid_status=200\n");const e=this.urlFileMap.get("@include");if(e){const t=new R;t.manifest=this;const s=e.getLines().map(t.fetchText,t);(await Promise.all(s)).forEach(this.parseFile,this)}}parseFile(t){let e="",s=0;for(;;){const n=m.exec(t);if(s>0){"@"!==e[0]&&(e=vt(e));const i=n?n.index:t.length,a=t.substring(s,i),r=new b(e,a);this.urlFileMap.set(e,r)}if(!n)break;e=n[0],s=m.lastIndex}const n=this.getParams("@__default__"),i=this.getParams("@global");this.globalParams=i?new Map([...n,...i]):n}}class g{constructor(t,e){this.fileParams=e,t&&([this.url,this.frag]=wt(vt(t),"#"))}static init(){this.nameClassMap={data:T,bundle:E,concat:N,open_timeout:B,recv_timeout:O,referrer_policy:W,req_headers:H,valid_status:Z,headers:F,expires:M,mime:tt,charset:L,pos:_,size:$,xor:Y,br:q,prefix:z,suffix:G,hash:P,stream:K},Object.values(this.nameClassMap).forEach(((t,e)=>{t.priority=e}))}parse(t){const e=new Map;if(bt(e,t.globalParams),this.url){const n="/"===this.url[0]?s:yt(this.url),i=t.getParams("@host "+n);i&&bt(e,i)}if(bt(e,this.fileParams),this.frag){bt(e,new URLSearchParams(this.frag))}const n=[];for(const[t,s]of e){const e=g.nameClassMap[t];if(!e){console.warn("[FreeCDN/UrlConf] unknown param:",t);continue}const i=e.parseConf(s);if(void 0===i)continue;if("string"==typeof i){console.warn("[FreeCDN/UrlConf] parseConf failed. mod:",t,"err:",i,"conf:",s);continue}const a=new e(...i);n.push(a)}return n.sort(((t,e)=>t.constructor.priority-e.constructor.priority)),n}}class x{constructor(t,e){this.url=t,this.paramMods=e,this.isFetchDone=!1,this.bytesRead=0}async load(t){let e,s=!1;try{e=await this.loadUnsafe(t),s=!!e}catch(t){console.assert(t instanceof h,t),e=t}if(e&&this.abortCtrl&&!this.abortCtrl.signal.aborted){for(const t of this.paramMods)t.onError(e);this.onError(e),s||this.abort(e)}}async loadUnsafe(t){const{rawReq:e}=t,{method:s}=e,n={method:s,referrer:e.referrer,referrerPolicy:"same-origin",headers:new Headers};let i;"POST"!==s&&"PUT"!==s||(n.body=await e.clone().arrayBuffer());for(const e of this.paramMods){const s=e.onRequest(n,t);if(s&&(i=U(s)?await s:s,i))break}if(!i){if(!this.url)return void this.onError(Error("vURL no data"));this.abortCtrl=new AbortController,n.signal=this.abortCtrl.signal;const t=new Request(this.url,n);try{i=await X.fetch(t)}catch(t){return t}}if(!i.body)return Error("cors error");const a={status:i.status,statusText:i.statusText,headers:new Headers,contentLen:-1};if(!i.headers.has("content-encoding")){const t=i.headers.get("content-length");t&&(a.contentLen=+t)}for(const e of this.paramMods)e.onResponse(a,t,i);const r=i.headers.get("content-range");if(r){const t=r.match(/bytes (\d+)-/i);if(t){const e=+t[1];e>0&&(this.bytesRead=e)}}a.contentLen>=0&&a.headers.set("content-length",a.contentLen+""),this.onResponse(a);const o=i.body.getReader();let l;t:for(;;){try{const{value:t}=await o.read();if(!t)break;l=t}catch(t){return t}for(const t of this.paramMods){const e=t.onData(l);if(l=U(e)?await e:e,0===l.length)continue t}l.length>0&&(this.pauseSignal&&await this.pauseSignal,this.bytesRead+=l.length,this.onData(l))}this.isFetchDone=!0,l=c;for(const t of this.paramMods){const e=t.onEnd(l);l=U(e)?await e:e}l.length>0&&(this.pauseSignal&&await this.pauseSignal,this.bytesRead+=l.length,this.onData(l)),this.onEnd()}pause(){this.pauseSignal=S()}resume(){this.pauseSignal.resolve(),this.pauseSignal=void 0}abort(t){if(!this.isFetchDone){this.abortCtrl?.abort();for(const e of this.paramMods)e.onAbort(t)}}}const w=/^\s+([^#\s].+?)\s*$/gm;class b{constructor(t,e){this.name=t,this.text=e}getLines(){const t=[];for(;;){const e=w.exec(this.text);if(!e)break;t.push(e[1])}return this.text="",t}parse(){if(""===this.text)return;const t=[],e=new Map;for(const s of this.getLines())if(/^https?:|^\//.test(s)){const n=new g(s,e);t.push(n)}else{const[t,n]=wt(s,"=");if(void 0===n){console.warn("[FreeCDN/FileConf] missing param value:",s);continue}e.set(t,n)}this.params=e,this.urlConfs=t}}const y=["open_timeout","recv_timeout","hash","req_headers","valid_status"];class v extends Error{constructor(t){super(t)}}class j{constructor(t,e,s,n,i){this.fileConf=t,this.rawReq=e,this.cdn=s,this.range=n,this.suffix=i,this.urlLoaderSet=new Set,this.isPaused=!1,this.isAborted=!1,this.delayTid=0,this.urlErrs=[],this.hasRange=!1,this.opened=!1,this.closed=!1,this.bytesRead=0;const a=t.params;if(n){const t=this.parseReqRange(n);t&&([this.rangeBegin,this.rangeEnd]=t,this.hasRange=!0,this.bytesRead=this.rangeBegin);const e=a.get("size");e&&(this.fileSize=+e)}(a.has("data")||a.has("bundle")||a.has("concat"))&&(this.vUrlConf=new g(void 0,a));const r=new Map;for(const t of y){const e=a.get(t);void 0!==e&&r.set(t,e)}const o=new g(t.name,r);this.urlConfs=t.urlConfs.concat(o)}parseReqRange(t){const e=t.match(/bytes=(\d+)-(\d*)/i);if(!e)return;const s=+e[1],n=+e[2];return 0!==n&&n<=s?void 0:[s,n]}buildResRange(t){const e=this.rangeBegin;let s=0;this.rangeEnd?s=this.rangeEnd-1:this.fileSize?s=this.fileSize-1:t.contentLen>0&&(s=t.contentLen);const n="bytes "+e+"-"+s+"/"+(this.fileSize||"*");if(t.status=206,t.headers.set("content-range",n),s>0){const n=s-e+1;t.headers.set("content-length",n+"")}}open(){this.loadNextUrl()}pause(){if(!this.isPaused){this.isPaused=!0;for(const t of this.urlLoaderSet)t.pause()}}resume(){if(this.isPaused){this.isPaused=!1;for(const t of this.urlLoaderSet)t.resume()}}abort(t){if(!this.isAborted){this.isAborted=!0;for(const e of this.urlLoaderSet)e.abort(t);0!==this.delayTid&&clearTimeout(this.delayTid)}}getNextUrl(){const{vUrlConf:t}=this;if(t)return this.vUrlConf=void 0,{weight:100,conf:t};const{urlConfs:e}=this,s=e.length-1;if(-1===s)return;const n=ft();let i=-1e4,a=0;e.forEach(((t,e)=>{const s=X.getUrlWeight(t.url,n,this.cdn.weightConf);s>i&&(i=s,a=e)}));const r=e[a];return e[a]=e[s],e.length=s,{weight:i,conf:r}}loadNextUrl(t=0){const e=this.getNextUrl();if(!e){if(0===this.urlLoaderSet.size){const t=new v("failed to load: "+this.getSourceUrl());t.urlErrs=this.urlErrs,this.onError(t)}return}const{weight:s,conf:n}=e;s<0&&t>0?this.delayTid=setTimeout((()=>{this.delayTid=0,this.createUrlLoader(n)}),t):this.createUrlLoader(n)}getSourceUrl(){return this.fileConf.name+this.suffix}getTargetUrl(t){return t.endsWith("/")?t+this.suffix:t}createUrlLoader(t){const e=t.url&&this.getTargetUrl(t.url),s=t.parse(this.cdn.manifest),n=new x(e,s);this.urlLoaderSet.add(n),n.onData=t=>{if(this.closed)return;const e=n.bytesRead-this.bytesRead;if(!(e<=0)){if(e!==t.length&&(t=t.subarray(-e)),this.bytesRead=n.bytesRead,this.rangeEnd){const e=this.bytesRead-this.rangeEnd;if(e>0)return t=t.subarray(0,-e),this.onData(t),void n.onEnd()}this.onData(t)}},n.onEnd=()=>{this.closed||(this.closed=!0,this.onEnd(),this.abort("TASK_DONE"))},n.onError=t=>{this.urlErrs.push({url:n.url||"",err:t}),this.urlLoaderSet.delete(n),this.loadNextUrl()},n.onResponse=t=>{this.opened||(this.hasRange&&this.buildResRange(t),this.opened=!0,this.onOpen(t))},n.load(this)}}const k=new Map;class C{constructor(t,n){this.onAvailable=n,this.urlWsMap=new Map,this.wsArgs="",this.manifestHash=c,this.pollingTimer=0,this.pollingInterval=3e5,this.lastTime=0,this.setSvcTimer=0,this.backupUrls=[];const i=new URL(t,e);console.assert(i.host===s);const a=i.pathname+i.search;"/freecdn-manifest.txt"!==a&&(this.wsArgs="?manifest="+encodeURIComponent(a)),this.manifestUrl=a}async getManifestFromCache(){const t=await V.findCache(this.manifestUrl);if(!t)return;const e=await t.arrayBuffer(),s=new Uint8Array(e);if(!await d.verify(s))return;const n=rt(s),i=new f;return await i.parse(n),i}async init(){const t=await this.getManifestFromCache();t&&this.onAvailable(t),await this.update()}async update(){if(this.updateSignal)return this.updateSignal;const t=Date.now();if(t-this.lastTime<1e3)return!0;this.lastTime=t,this.updateSignal=S();let e=!1;try{e=await this.updateUnsafe()}catch(t){console.error("[FreeCDN/Updater] update err:",t)}return this.updateSignal.resolve(e),this.updateSignal=void 0,e}async updateUnsafe(){const t=await this.fetchManifest(this.manifestUrl);if(t)return await this.applyManifest(t),!0;if(console.warn("[FreeCDN/Updater] failed to fetch 1st manifest:",this.manifestUrl),0===this.backupUrls.length)return console.warn("[FreeCDN/Updater] no backup url"),!1;for(const t of this.backupUrls){const e=await this.fetchManifest(t);if(e){if(await d.verify(e))return await this.applyManifest(e),!0;console.warn("[FreeCDN/Updater] failed to verify 3rd manifest:",t)}else console.warn("[FreeCDN/Updater] failed to fetch 3rd manifest:",t)}return console.warn("[FreeCDN/Updater] failed to reload"),!1}async fetchManifest(t){const e=new AbortController,s=setTimeout((()=>{e.abort()}),3e3),n=new Request(t,{cache:"no-cache",signal:e.signal});try{const t=await X.fetch(n),e=await t.arrayBuffer();return new Uint8Array(e)}catch{}finally{clearTimeout(s)}}async applyManifest(t){const e=await jt(t);if(xt(this.manifestHash,e))return;this.manifestHash=e;const s=new Response(t);s.headers.set("content-length",t.length+""),V.addCache(this.manifestUrl,s);const n=new f,i=rt(t);await n.parse(i),this.onAvailable(n)}applyConfs(t){this.backupUrls=this.parseBackupParam(t);const e=this.parseIntervalParam(t);this.setPollingInterval(e);const s=this.parseServicesParam(t);this.setSvcTimer>0&&clearTimeout(this.setSvcTimer),this.setSvcTimer=setTimeout((()=>{this.setSvcTimer=0,this.setServices(s)}),5e3)}parseBackupParam(t){return pt(t.get("backup")||"")}parseIntervalParam(t){const e=t.get("interval");if(e){const t=dt(e);if(!isNaN(t))return t;console.warn("[FreeCDN/Updater] invalid interval:",e)}return 3e5}parseServicesParam(t){return pt(t.get("services")||"")}setPollingInterval(t){this.pollingInterval!==t&&(this.pollingInterval,this.pollingTimer&&clearInterval(this.pollingTimer),t>0&&(this.pollingTimer=setInterval((()=>{this.update()}),t)))}setServices(t){for(const[e,s]of this.urlWsMap)t.includes(e)||(s.onclose=null,s.close(),this.urlWsMap.delete(e));for(const e of t)this.urlWsMap.has(e)||this.createSvc(e)}createSvc(t){const e=new WebSocket(t+this.wsArgs);e.binaryType="arraybuffer",e.onmessage=t=>{const e=new Uint8Array(t.data);xt(this.manifestHash,e)||this.update()},e.onclose=()=>{this.urlWsMap.delete(t),setTimeout((()=>{this.createSvc(t)}),2e4)},this.urlWsMap.set(t,e)}}class R{constructor(t){if(this.enableCacheStorage=!0,this.isSubReq=!1,this.weightConf=new Map,this.inited=!1,!t)return;const e=new C(t,(t=>{this.manifest=t;const s=t.getParams("@update")||k;e.applyConfs(s),this.weightConf=X.parseWeightConf(t)}));this.updater=e}async fetch(t,e){const s=t instanceof Request&&!e?t:new Request(t,e);if(!/^https?:/.test(s.url))return o(s);const{manifest:i}=this;if(!i)return X.fetch(s);let a,l="";t:for(;;){const t=new URL(s.url),e=t.origin===n?"":t.origin;if(t.search&&(a=i.get(e+t.pathname+t.search),a))break;const o=t.pathname.replace(/\/{2,}/g,"/"),c=e+o;if(r.test(c)&&"cors"!==s.mode&&!s.integrity){const t=s.headers.get("accept")||"";if(t.includes("image/avif")&&(a=i.get(c+".avif"),a))break;if(t.includes("image/webp")&&(a=i.get(c+".webp"),a))break}if(a=i.get(c),a)break;if(c.endsWith("/")&&(a=i.get(c+"index.html"),a))break;if(i.has(c+"/index.html"))return Response.redirect(c+"/");let p=o.replace(/[^/]*$/,"");for(;;){if(a=i.get(e+p),a){l=o.substring(p.length)+t.search;break t}if("/"===p)break;p=p.replace(/[^/]+\/$/,"")}return X.fetch(s)}a.parse();let p="";const h=a.params.get("hash");h&&44===h.length&&(p=h);const u=s.headers.get("range"),d=this.enableCacheStorage&&p&&!u;if(d){const t=await V.findHash(p);if(t)return t}const m=new j(a,s,this,u,l),f=S();if(s.signal.addEventListener("abort",(()=>{const t=s.signal.reason||"unknown";m.abort(t)})),p){let t,e;return m.onOpen=e=>{t=e},m.onData=t=>{e=t},m.onEnd=()=>{const n=e||c,i=new Response(n,t);if(d&&n.length<5242880){const t=i.clone();t.headers.set("content-length",n.length+""),t.headers.set("x-raw-url",s.url),V.addHash(p,t)}f.resolve(i)},m.onError=t=>{console.warn("[FreeCDN]",t.message,t.urlErrs),f.reject(t)},m.open(),f}let g;const x=()=>{const{desiredSize:t}=g;null!==t?t<=0?m.pause():m.resume():console.warn("desiredSize is null")},w=new ReadableStream({start(t){g=t},pull:x,cancel(t){console.warn("[FreeCDN] stream cancel:",t),m.abort(t)}});return m.onData=t=>{g.enqueue(t),x()},m.onEnd=()=>{g.close()},m.onError=t=>{g.error(t),console.warn("[FreeCDN]",t.message,t.urlErrs),f.reject(t)},m.onOpen=t=>{const e=new Response(w,t);f.resolve(e)},m.open(),f}async fetchText(t){return(await this.fetch(t)).text()}async fetchBin(t){const e=await this.fetch(t),s=await e.arrayBuffer();return new Uint8Array(s)}async fetchBlob(t){const e=await this.fetch(t),s=await e.arrayBuffer(),n=e.headers.get("content-type")||"";return new Blob([s],{type:n})}async update(){return!!this.updater&&this.updater.update()}async setPublicKey(t){124!==t.length&&(t=`MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAE${t}==`),await d.set(t)}async init(){console.assert(!this.inited),this.inited=!0,await async function(){if(p)return p;p=S(),await V.init(),await X.init(),g.init(),p.resolve(),p=!0}(),this.updater&&await this.updater.init()}}function S(){let t,e;const s=new Promise(((s,n)=>{t=s,e=n}));return s.resolve=t,s.reject=e,s}function U(t){return"function"==typeof t.then}var D;!function(s){const n=self,i=new Response("/* freecdn is installed */",{headers:{"content-type":"text/javascript","cache-control":"max-age=3600"}});let a,r,o;async function c(t,e){r&&await r;const s=t instanceof Request&&!e?t:new Request(t,e),n=await a.fetch(s);return o.set(n,s.url),n}function l(t,s,n){const r=t.request;r.url.endsWith("/freecdn-update")?a.update().then((t=>{const e=new Response("updated. success: "+t,{headers:{"content-type":"text/html"}});s(e)})):r.url!==e?a.fetch(r).then(s,n):s(i.clone())}!async function(){a=new R("freecdn-manifest.txt");const e=!!n.FREECDN_SHARED_MODE;let s;e?(a.enableCacheStorage=!1,r=S(),t.func(n,"fetch",(t=>c)),t.func(Cache.prototype,"add",(t=>async function(t){const e=await c(t);await this.put(t,e)})),t.func(Cache.prototype,"addAll",(t=>async function(t){const e=t.map((t=>this.add(t)));await Promise.all(e)})),o=new WeakMap,t.prop(Response.prototype,"url",(t=>function(){return o.get(this)||t.call(this)}),null),t.func(Response.prototype,"clone",(t=>function(){const e=t.call(this),s=o.get(this);return s&&o.set(e,s),e})),s=n.FREECDN_PUBLIC_KEY):s=Q.shift(),s&&await a.setPublicKey(s),await a.init(),e?(r?.resolve(),r=null):function(){for(Q.push=l;Q.length;)l(...Q.splice(0,3))}(),console.log("[FreeCDN] service worker inited")}()}(D||(D={}));class q extends u{constructor(){super(),this.state=0}static async init(){if(this.signal)return;this.signal=S();const t=`${a}/br/br.wasm`,e=`${a}/br/br.min.js`,s=`\n${t}\n\thttps://cdn.jsdelivr.net/npm/freecdn-js@0.4.1/dist/br/br.wasm\n\thttps://unpkg.com/freecdn-js@0.4.1/dist/br/br.wasm\n\thttps://code.bdstatic.com/npm/freecdn-js@0.4.1/dist/br/br.wasm\n\thttps://npm.elemecdn.com/freecdn-js@0.4.1/dist/br/br.wasm\n\thash=w7Zbum/oD8CzP5UKtRDW8+0bmoFIHs06PfiGF42t0uw=\n\n${e}\n\thttps://cdn.jsdelivr.net/npm/freecdn-js@0.4.1/dist/br/br.min.js\n\thttps://unpkg.com/freecdn-js@0.4.1/dist/br/br.min.js\n\thttps://code.bdstatic.com/npm/freecdn-js@0.4.1/dist/br/br.min.js\n\thttps://npm.elemecdn.com/freecdn-js@0.4.1/dist/br/br.min.js\n\thash=gqmgnA8vf/OANpMvdOnpyPZ1Un4WqQZonOsf2FqndZg=\n`,n=()=>{this.hasErr=!0,this.signal?.resolve()},i=setTimeout(n,2e4),r={locateFile:()=>t,onRuntimeInitialized:()=>{this.inPtr=r._AllocInBuf(131072),this.outPtr=r._AllocOutBuf(524288),clearTimeout(i),this.signal?.resolve(),this.signal=void 0},onAbort:t=>{console.warn("[FreeCDN/Br] wasm onAbort:",t),n()},print:t=>{console.warn("[FreeCDN/Br] wasm print:",t)},printErr:t=>{console.warn("[FreeCDN/Br] wasm printErr:",t)}},o=new f;await o.parse(s);const c=new R;c.manifest=o;const l=async(...t)=>{try{return await c.fetch(...t)}catch(t){throw console.warn("[FreeCDN/Br] failed to load wasm"),n(),t}};try{const t=await c.fetchText(e);Function("Module","fetch",t)(r,l)}catch{return console.warn("[FreeCDN/Br] failed to execute glue js"),void n()}this.asmMod=r}static parseConf(t){if("off"!==t)return"on"===t?(this.asmMod||this.init(),[]):"invalid value"}onResponse(t){t.contentLen=-1}async onData(t){return q.signal&&await this.waitWasm(),this.process(t)}async onEnd(t){q.signal&&await this.waitWasm();let e=c;return t.length>0&&(e=this.process(t)),this.destory(),e}async waitWasm(){if(await q.signal,q.hasErr)throw new h("failed to load br decoder")}process(t){const e=q.asmMod,s=e.HEAPU8;0===this.state&&(this.state=e._Init());const n=[];for(let i=0;i<t.length;i+=131072){const a=t.subarray(i,i+131072);s.set(a,q.inPtr);let r=a.length,o=0;do{if(0===e._Update(this.state,0,r)){const t=e._GetErrorCode();throw this.destory(),new h("br decode failed. code: "+t)}r=e._GetAvailableIn(),o=e._GetAvailableOut();const t=524288-o;if(0===t)continue;const i=s.slice(q.outPtr,q.outPtr+t);n.push(i)}while(e._HasMoreOutput(this.state))}return 1===n.length?n[0]:gt(n)}destory(){q.asmMod._Destroy(this.state)}}q.hasErr=!1;class E extends u{constructor(t){super(),this.packUrl=t}static parseConf(t){if("off"!==t)return/^https?:|^\//.test(t)?[t]:"invalid url"}async onRequest(t,e){if(e.cdn.isSubReq)return;let s,n=E.cache.get(this.packUrl);if(n||(n=S(),E.cache.set(this.packUrl,n),this.loadPkg(e,n).catch(n.reject.bind(n))),U(n))try{n=await n}catch(t){return void("string"==typeof t?this.warn(t):console.assert(t instanceof st,t))}for(;;){const t=e.suffix;if(s=n.get(t),s)break;if(""===t){s=n.get("index.html"),s&&(e.suffix="index.html");break}if(t.endsWith("/")){s=n.get(t+"index.html"),s&&(e.suffix=t+"index.html");break}if(n.has(t+"/index.html"))return e.suffix=t+"/index.html",new Response("<script>location.pathname+='/'<\/script>");break}return s?(1===s&&(s=S(),n.set(e.suffix,s)),U(s)&&(s=await s),s.clone()):void 0}async loadPkg(t,e){const s=new Map,n=new R;n.manifest=t.cdn.manifest,n.weightConf=t.cdn.weightConf,n.isSubReq=!0;const i=new nt;try{const t=await n.fetch(this.packUrl);i.source=t.body.getReader()}catch{throw"failed to load"}const a=await i.findAsync(13);if(-1===a)throw"missing header";const r=lt(rt(await i.readBytesAsync(a+1)));if(!r||"object"!=typeof r)throw"invalid header";for(const t of Object.keys(r))s.set(t,1);e.resolve(s);for(const[t,e]of Object.entries(r)){const n=+e["content-length"];if(!(n>=0))throw"invalid content-length";const a=await i.readBytesAsync(n),o=new Response(a,{headers:r[t]}),c=s.get(t);1!==c&&c.resolve(o),s.set(t,o)}}warn(t){console.warn("[FreeCDN/Bundle]",t,this.packUrl)}}E.cache=new Map;const A=/^text\/|^application\/(?:javascript|json)|\+xml$/;class L extends u{constructor(t){super(),this.charset=t}static parseConf(t){if("off"!==t)return[t]}onResponse(t){const e=t.headers.get("content-type")||"";A.test(e)&&t.headers.set("content-type",e+"; charset="+this.charset)}}L.reuse=!0;class N extends u{constructor(t,e){super(),this.partLen=t,this.urls=e}static parseConf(t){if("off"===t)return;const e=pt(t);if(0===e.length)return"missing url";let s=mt(e[0]);s>0?e.shift():s=-1;for(const t of e)if(!/^https?:|^\//.test(t))return"invalid url";return[s,e]}async onRequest(t,e){if(e.cdn.isSubReq)return;const s=e.cdn.manifest,n=[],i=/\[(\d+)-(\d+)\]/;for(const t of this.urls){let e=0,a=0,r=0;const o=t.match(i);if(o){const t=o[1];e=+t,a=+o[2],r="0"===t[0]?t.length:0}for(let c=e;c<=a;c++){const e=o?t.replace(i,(c+"").padStart(r,"0")):t,a=s.get(e);if(a){a.parse();const t=a.params.get("size");n.push({url:a.name,size:t?+t:this.partLen})}else n.push({url:e,size:this.partLen})}}n.reverse();const a=new Headers,{rangeBegin:r}=e;if(r&&r>0){let t=0;for(let e=n.length-1;e>=0;e--){const{size:s}=n[e];if(-1===s)break;if(t+s>r){t&&a.set("content-range",`bytes ${t}-`);break}n.pop(),t+=s}}const o=new R;let c,l;o.manifest=e.cdn.manifest,o.weightConf=e.cdn.weightConf,o.isSubReq=!0;const p=async()=>{const t=n.pop();if(!t)return l.close(),!1;this.abortCtrl=new AbortController;try{const e=await o.fetch(t.url,{signal:this.abortCtrl.signal});c=e.body.getReader()}catch(t){return l.error(t),!1}return!0},h=async()=>{let t;try{const{value:e}=await c.read();t=e}catch(t){return void l.error(t)}t?l.enqueue(t):await p()&&await h()},u=new ReadableStream({async start(t){l=t,await p()},pull:h});return new Response(u,{headers:a})}onAbort(t){this.abortCtrl&&(this.abortCtrl.abort(t),this.abortCtrl=void 0)}}class T extends u{constructor(t){super(),this.bytes=t}static parseConf(t){const e=ht(t);return e?[e]:"invalid format"}onRequest(){return new Response(this.bytes)}}T.reuse=!0;class M extends u{constructor(t){super(),this.seconds=t}static parseConf(t){const e=dt(t);if(isNaN(e))return"invalid time format";return[e/1e3|0]}onResponse(t,e,s){const n=s._maxage,i=n<this.seconds?n:this.seconds;t.headers.append("cache-control","max-age="+i)}}M.reuse=!0;class P extends u{constructor(t,e){super(),this.blkLen=t,this.hashBins=e,this.reader=new nt,this.hasData=!1}static parseConf(t){let e=1e9,s=t;const n=t.indexOf(";");if(n>0){const i=t.substring(0,n);if(s=t.substring(n+1),e=mt(i),isNaN(e))return"invalid block length"}const i=[],a=s.split(",");for(let t=a.length-1;-1!==t;t--){const e=ct(a[t]);if(!e||32!==e.length)return"invalid block hash";i.push(e)}return[e,i]}onData(t){if(this.hasData=!0,this.reader.feed(t),this.reader.availLen>52428800)throw new h("max queue length exceeded");return this.reader.availLen<this.blkLen?c:this.pull(this.reader.availLen%this.blkLen)}async onEnd(t){return t.length>0&&this.reader.feed(t),0===this.reader.availLen?(this.hasData||await this.verify(c),c):this.pull(0)}async pull(t){const e=this.reader.readBytesSync(this.reader.availLen-t);for(let t=0;t<e.length;t+=this.blkLen){const s=e.subarray(t,t+this.blkLen);await this.verify(s)}return e}async verify(t){const e=this.hashBins.pop();if(!e)throw new h("missing hash");const s=await jt(t);if(!xt(e,s)){const t=ot(e),n=ot(s);throw new h(`hash incorrect. expected: ${t}, but got: ${n}`)}}}class F extends u{constructor(t,e){super(),this.headers=t,this.preserveAll=e}static parseConf(t){return H.parse(t)}onResponse(t,e,s){if(this.preserveAll){for(const[e,n]of s.headers)t.headers.set(e,n);for(const[e,s]of this.headers)t.headers.set(e,s)}else for(const[e,n]of this.headers)if(""===n){const n=s.headers.get(e);null!==n&&t.headers.set(e,n)}else t.headers.set(e,n)}}F.reuse=!0;class B extends u{constructor(t){super(),this.time=t,this.tid=0}static parseConf(t){const e=dt(t);return isNaN(e)?"invalid time format":[e]}onRequest(t,e){this.tid=setTimeout((()=>{const t=Math.max(this.time,5e3);e.loadNextUrl(t)}),this.time)}onResponse(){this.stopTimer()}onError(){this.stopTimer()}onAbort(){this.stopTimer()}stopTimer(){this.tid>0&&(clearTimeout(this.tid),this.tid=0)}}class _ extends u{constructor(t){super(),this.remain=t}static parseConf(t){const e=mt(t);return isNaN(e)?"invalid byte format":0!==e?[e]:void 0}onResponse(t){t.contentLen>=0&&(t.contentLen-=this.remain)<0&&(t.contentLen=0)}onData(t){if(this.remain<=0)return t;const e=this.remain-=t.length;return e>=0?c:t.subarray(e)}onEnd(t){return this.onData(t)}}class z extends u{constructor(t){super(),this.bytes=t,this.done=!1}static parseConf(t){const e=ht(t);return e?[e]:"invalid format"}onResponse(t){t.contentLen>=0&&(t.contentLen+=this.bytes.length)}onData(t){return this.done?t:(this.done=!0,gt([this.bytes,t]))}onEnd(t){return this.onData(t)}}class O extends u{constructor(t,e){super(),this.bytes=t,this.time=e,this.tid=0,this.sum=0}static parseConf(t){const[e,s]=t.split("/"),n=mt(e),i=dt(s);return isNaN(n)?"invalid byte format":isNaN(i)?"invalid time format":[n,i]}onRequest(t,e){this.fileLoader=e}onResponse(){this.tid=setInterval((()=>{this.sum<=this.bytes&&(this.stopTimer(),this.fileLoader.loadNextUrl()),this.sum=0}),this.time)}onData(t){return this.sum+=t.length,t}onEnd(t){return this.stopTimer(),t}onError(){this.stopTimer()}onAbort(){this.stopTimer()}stopTimer(){this.tid>0&&(clearInterval(this.tid),this.tid=0)}}const I=/^(?:no-referrer|unsafe-url|origin|same-origin|strict-origin|no-referrer-when-downgrade|origin-when-cross-origin|strict-origin-when-cross-origin)$/;class W extends u{constructor(t){super(),this.policy=t}static parseConf(t){return"raw"===t?[""]:I.test(t)?[t]:"invalid value"}onRequest(t,e){t.referrerPolicy=this.policy||e.rawReq.referrerPolicy}}W.reuse=!0;class H extends u{constructor(t,e){super(),this.headers=t,this.preserveAll=e}static parse(t){const e=[];let s=!1;const n=lt(t);if("object"!=typeof n)return"invalid format";for(const[t,i]of Object.entries(n))"*"===t?s=!0:e.push([t,i+""]);return[e,s]}static parseConf(t){return this.parse(t)}onRequest(t,e){const{rawReq:s}=e;if(this.preserveAll){for(const[e,n]of s.headers)t.headers.set(e,n);for(const[e,s]of this.headers)t.headers.set(e,s)}else for(const[e,n]of this.headers)if("referer"!==e)if(""===n){const n=s.headers.get(e);null!==n&&t.headers.set(e,n)}else t.headers.set(e,n);else t.referrer=n||s.referrer}}H.reuse=!0;class $ extends u{constructor(t){super(),this.remain=t}static parseConf(t){const e=mt(t);return isNaN(e)?"invalid byte format":[e]}onResponse(t){t.contentLen=this.remain}onData(t){if(this.remain<=0)return c;const e=this.remain-=t.length;return e>=0?t:t.subarray(0,e)}onEnd(t){return this.onData(t)}}class K extends u{constructor(){super(),this.queueArr=[],this.queueLen=0}static parseConf(t){if("on"!==t)return"off"===t?[]:"invalid value"}onData(t){if(this.queueLen+=t.length,this.queueLen>52428800)throw new h("max queue length exceeded");return this.queueArr.push(t),c}onEnd(t){return t.length>0&&this.onData(t),gt(this.queueArr,this.queueLen)}}class G extends u{constructor(t){super(),this.bytes=t}static parseConf(t){const e=ht(t);return e?[e]:"invalid format"}onResponse(t){t.contentLen>=0&&(t.contentLen+=this.bytes.length)}onEnd(t){return 0===t.length?this.bytes:gt([t,this.bytes])}}G.reuse=!0;class Z extends u{constructor(t){super(),this.codes=t}static parseConf(t){if("*"===t)return;return[t.split(",").map(Number)]}onResponse(t,e,s){if(!this.codes.includes(s.status))throw new h("invalid http status: "+s.status)}}Z.reuse=!0;class Y extends u{constructor(t){super(),this.key=t}static parseConf(t){const e=+t>>>0;return e>255?"invalid value":[e]}onData(t){for(let e=0;e<t.length;e++)t[e]^=this.key;return t}onEnd(t){return this.onData(t)}}Y.reuse=!0;var J,V,X;class tt extends u{constructor(t){super(),this.mime=t}static parseConf(t){return"auto"===t?[""]:[t]}onResponse(t,e,s){let n;if(""===this.mime){const t=e.getSourceUrl();if(!t.includes("?")){const e=t.match(/\.(\w+)$/);if(e){const t=e[1].toLowerCase();n=tt.extTypeMap.get(t)}}if(!n){const t=s.headers.get("content-type");n=t?wt(t,";")[0]:"application/octet-stream"}}else n=this.mime;t.headers.set("content-type",n)}}J=tt,tt.reuse=!0,(()=>{const t=new Map;for(const e of"application/andrew-inset:ez;application/applixware:aw;application/atom+xml:atom;application/atomcat+xml:atomcat;application/atomdeleted+xml:atomdeleted;application/atomsvc+xml:atomsvc;application/atsc-dwd+xml:dwd;application/atsc-held+xml:held;application/atsc-rsat+xml:rsat;application/bdoc:bdoc;application/calendar+xml:xcs;application/ccxml+xml:ccxml;application/cdfx+xml:cdfx;application/cdmi-capability:cdmia;application/cdmi-container:cdmic;application/cdmi-domain:cdmid;application/cdmi-object:cdmio;application/cdmi-queue:cdmiq;application/cu-seeme:cu;application/dash+xml:mpd;application/davmount+xml:davmount;application/docbook+xml:dbk;application/dssc+der:dssc;application/dssc+xml:xdssc;application/ecmascript:ecma,es;application/emma+xml:emma;application/emotionml+xml:emotionml;application/epub+zip:epub;application/exi:exi;application/fdt+xml:fdt;application/font-tdpfr:pfr;application/geo+json:geojson;application/gml+xml:gml;application/gpx+xml:gpx;application/gxf:gxf;application/gzip:gz;application/hjson:hjson;application/hyperstudio:stk;application/inkml+xml:ink,inkml;application/ipfix:ipfix;application/its+xml:its;application/java-archive:jar,war,ear;application/java-serialized-object:ser;application/java-vm:class;application/javascript:js,mjs;application/json:json,map;application/json5:json5;application/jsonml+json:jsonml;application/ld+json:jsonld;application/lgr+xml:lgr;application/lost+xml:lostxml;application/mac-binhex40:hqx;application/mac-compactpro:cpt;application/mads+xml:mads;application/manifest+json:webmanifest;application/marc:mrc;application/marcxml+xml:mrcx;application/mathematica:ma,nb,mb;application/mathml+xml:mathml;application/mbox:mbox;application/mediaservercontrol+xml:mscml;application/metalink+xml:metalink;application/metalink4+xml:meta4;application/mets+xml:mets;application/mmt-aei+xml:maei;application/mmt-usd+xml:musd;application/mods+xml:mods;application/mp21:m21,mp21;application/mp4:mp4s,m4p;application/mrb-consumer+xml:xdf;application/mrb-publish+xml:xdf;application/msword:doc,dot;application/mxf:mxf;application/n-quads:nq;application/n-triples:nt;application/node:cjs;application/octet-stream:bin,dms,lrf,mar,so,dist,distz,pkg,bpk,dump,elc,deploy,exe,dll,deb,dmg,iso,img,msi,msp,msm,buffer;application/oda:oda;application/oebps-package+xml:opf;application/ogg:ogx;application/omdoc+xml:omdoc;application/onenote:onetoc,onetoc2,onetmp,onepkg;application/oxps:oxps;application/p2p-overlay+xml:relo;application/patch-ops-error+xml:xer;application/pdf:pdf;application/pgp-encrypted:pgp;application/pgp-signature:asc,sig;application/pics-rules:prf;application/pkcs10:p10;application/pkcs7-mime:p7m,p7c;application/pkcs7-signature:p7s;application/pkcs8:p8;application/pkix-attr-cert:ac;application/pkix-cert:cer;application/pkix-crl:crl;application/pkix-pkipath:pkipath;application/pkixcmp:pki;application/pls+xml:pls;application/postscript:ai,eps,ps;application/provenance+xml:provx;application/pskc+xml:pskcxml;application/raml+yaml:raml;application/rdf+xml:rdf,owl;application/reginfo+xml:rif;application/relax-ng-compact-syntax:rnc;application/resource-lists+xml:rl;application/resource-lists-diff+xml:rld;application/rls-services+xml:rs;application/route-apd+xml:rapd;application/route-s-tsid+xml:sls;application/route-usd+xml:rusd;application/rpki-ghostbusters:gbr;application/rpki-manifest:mft;application/rpki-roa:roa;application/rsd+xml:rsd;application/rss+xml:rss;application/rtf:rtf;application/sbml+xml:sbml;application/scvp-cv-request:scq;application/scvp-cv-response:scs;application/scvp-vp-request:spq;application/scvp-vp-response:spp;application/sdp:sdp;application/senml+xml:senmlx;application/sensml+xml:sensmlx;application/set-payment-initiation:setpay;application/set-registration-initiation:setreg;application/shf+xml:shf;application/sieve:siv,sieve;application/smil+xml:smi,smil;application/sparql-query:rq;application/sparql-results+xml:srx;application/srgs:gram;application/srgs+xml:grxml;application/sru+xml:sru;application/ssdl+xml:ssdl;application/ssml+xml:ssml;application/swid+xml:swidtag;application/tei+xml:tei,teicorpus;application/thraud+xml:tfi;application/timestamped-data:tsd;application/toml:toml;application/ttml+xml:ttml;application/ubjson:ubj;application/urc-ressheet+xml:rsheet;application/urc-targetdesc+xml:td;application/voicexml+xml:vxml;application/wasm:wasm;application/widget:wgt;application/winhlp:hlp;application/wsdl+xml:wsdl;application/wspolicy+xml:wspolicy;application/xaml+xml:xaml;application/xcap-att+xml:xav;application/xcap-caps+xml:xca;application/xcap-diff+xml:xdf;application/xcap-el+xml:xel;application/xcap-error+xml:xer;application/xcap-ns+xml:xns;application/xenc+xml:xenc;application/xhtml+xml:xhtml,xht;application/xliff+xml:xlf;application/xml:xml,xsl,xsd,rng;application/xml-dtd:dtd;application/xop+xml:xop;application/xproc+xml:xpl;application/xslt+xml:xsl,xslt;application/xspf+xml:xspf;application/xv+xml:mxml,xhvml,xvml,xvm;application/yang:yang;application/yin+xml:yin;application/zip:zip;audio/3gpp:3gpp;audio/adpcm:adp;audio/amr:amr;audio/basic:au,snd;audio/midi:mid,midi,kar,rmi;audio/mobile-xmf:mxmf;audio/mp3:mp3;audio/mp4:m4a,mp4a;audio/mpeg:mpga,mp2,mp2a,mp3,m2a,m3a;audio/ogg:oga,ogg,spx,opus;audio/s3m:s3m;audio/silk:sil;audio/wav:wav;audio/wave:wav;audio/webm:weba;audio/xm:xm;font/collection:ttc;font/otf:otf;font/ttf:ttf;font/woff:woff;font/woff2:woff2;image/aces:exr;image/apng:apng;image/avif:avif;image/bmp:bmp;image/cgm:cgm;image/dicom-rle:drle;image/emf:emf;image/fits:fits;image/g3fax:g3;image/gif:gif;image/heic:heic;image/heic-sequence:heics;image/heif:heif;image/heif-sequence:heifs;image/hej2k:hej2;image/hsj2:hsj2;image/ief:ief;image/jls:jls;image/jp2:jp2,jpg2;image/jpeg:jpeg,jpg,jpe;image/jph:jph;image/jphc:jhc;image/jpm:jpm;image/jpx:jpx,jpf;image/jxr:jxr;image/jxra:jxra;image/jxrs:jxrs;image/jxs:jxs;image/jxsc:jxsc;image/jxsi:jxsi;image/jxss:jxss;image/ktx:ktx;image/ktx2:ktx2;image/png:png;image/sgi:sgi;image/svg+xml:svg,svgz;image/t38:t38;image/tiff:tif,tiff;image/tiff-fx:tfx;image/webp:webp;image/wmf:wmf;message/disposition-notification:disposition-notification;message/global:u8msg;message/global-delivery-status:u8dsn;message/global-disposition-notification:u8mdn;message/global-headers:u8hdr;message/rfc822:eml,mime;model/3mf:3mf;model/gltf+json:gltf;model/gltf-binary:glb;model/iges:igs,iges;model/mesh:msh,mesh,silo;model/mtl:mtl;model/obj:obj;model/stl:stl;model/vrml:wrl,vrml;model/x3d+binary:x3db,x3dbz;model/x3d+fastinfoset:x3db;model/x3d+vrml:x3dv,x3dvz;model/x3d+xml:x3d,x3dz;model/x3d-vrml:x3dv;text/cache-manifest:appcache,manifest;text/calendar:ics,ifb;text/coffeescript:coffee,litcoffee;text/css:css;text/csv:csv;text/html:html,htm,shtml;text/jade:jade;text/jsx:jsx;text/less:less;text/markdown:markdown,md;text/mathml:mml;text/mdx:mdx;text/n3:n3;text/plain:txt,text,conf,def,list,log,in,ini;text/richtext:rtx;text/rtf:rtf;text/sgml:sgml,sgm;text/shex:shex;text/slim:slim,slm;text/spdx:spdx;text/stylus:stylus,styl;text/tab-separated-values:tsv;text/troff:t,tr,roff,man,me,ms;text/turtle:ttl;text/uri-list:uri,uris,urls;text/vcard:vcard;text/vtt:vtt;text/xml:xml;text/yaml:yaml,yml;video/3gpp:3gp,3gpp;video/3gpp2:3g2;video/h261:h261;video/h263:h263;video/h264:h264;video/iso.segment:m4s;video/jpeg:jpgv;video/jpm:jpm,jpgm;video/mj2:mj2,mjp2;video/mp2t:ts;video/mp4:mp4,mp4v,mpg4;video/mpeg:mpeg,mpg,mpe,m1v,m2v;video/ogg:ogv;video/quicktime:qt,mov;video/webm:webm".split(";")){const[s,n]=wt(e,":");for(const e of n.split(","))t.set(e,s)}J.extTypeMap=t})(),function(t){let e;function s(t){return e.match(t)}async function n(t,s){try{await e.put(t,s)}catch{}}function i(t){return e.delete(t)}t.init=async function(){e||(e=await caches.open(".freecdn"))},t.findHash=async function(t){const e=await s("/"+t);if(!e)return;const n=await e.clone().arrayBuffer(),a=new Uint8Array(n),r=await jt(a),o=ct(t);return o?xt(r,o)?e:(console.warn("[FreeCDN/CacheManager] bad cache:",t),void i("/"+t)):void 0},t.addHash=async function(t,e){await n("/"+t,e)},t.findCache=s,t.addCache=n,t.delCache=i}(V||(V={}));class et{constructor(t){this.name=t}open(t){const e=S(),s=indexedDB.open(this.name);return s.onsuccess=()=>{const n=s.result;this.db=n,n.onclose=()=>{console.warn("[FreeCDN/Database] indexedDB disconnected, reopen..."),this.open(t)},e.resolve()},s.onerror=t=>{console.warn("[FreeCDN/Database] indexedDB open error:",t),e.reject(s.error)},s.onupgradeneeded=()=>{const e=s.result;for(const[s,n]of Object.entries(t))e.createObjectStore(s,n)},e}close(){this.db.close()}get(t,e){const s=S(),n=this.getStore(t,"readonly").get(e);return n.onsuccess=()=>{s.resolve(n.result)},n.onerror=()=>{s.reject(n.error)},s}put(t,e){const s=S(),n=this.getStore(t,"readwrite").put(e);return n.onsuccess=()=>{s.resolve()},n.onerror=()=>{s.reject(n.error)},s}delete(t,e){const s=S(),n=this.getStore(t,"readwrite").delete(e);return n.onsuccess=()=>{s.resolve()},n.onerror=()=>{s.reject(n.error)},s}enum(t,e,...s){const n=S(),i=this.getStore(t,"readonly").openCursor(...s);return i.onsuccess=()=>{const{result:t}=i;if(!t)return void n.resolve();!1!==e(t.value)&&t.continue()},i.onerror=()=>{n.reject(i.error)},n}getStore(t,e){return this.db.transaction(t,e).objectStore(t)}}!function(t){const e=new et(".freecdn"),n=new Map;function i(t,s,i){if(n.has(t))return;const a={url:t,status:s,expire:i};n.set(t,a),e.put("cache",a)}class a{constructor(){this.lastDoneTime=0,this.lastErrTime=0,this.pending=0,this.errNum=0,this.reqNum=0,this.reqTimeAvg=-1,this.reqTimeSum=0}}const r=new Map;function c(t){let e=r.get(t);return e||(e=new a,r.set(t,e)),e}t.getUrlWeight=function(t,e,i){const a=n.get(t);if(a&&a.expire<e)return 200!==a.status?-2:100+a.expire;if("/"===t[0])return i.get(s)??-1;const o=yt(t),c=r.get(o);return c?function(t,e){if(-1!==t.reqTimeAvg){const e=100-.2*t.reqTimeAvg;return Math.max(e,10)}return 50}(c):i.get(o)??50},t.fetch=async function(t){const e=c(yt(t.url));e.pending++;const s=ft();let n;try{n=await o(t)}catch(n){throw function(t,e,s,n){if(!navigator.onLine)return;if(!l.test(t.message))return;if("only-if-cached"===e.cache)return;s.errNum++,s.lastErrTime=n}(n,t,e,s),n}finally{e.pending--}const a=function(t,e){const s=t.get("cache-control");if(null!==s){if(s.includes("no-cache"))return 0;const t=s.match(/max-age="?(\d+)"?/);if(t)return+t[1]}const n=t.get("expires");if(null!==n){const t=Date.parse(n)/1e3;if(t)return t-e|0}return 300}(n.headers,s);switch(n.status){case 200:"no-store"!==t.cache&&a>60&&i(n.url,200,s+a);break;case 404:i(n.url,404,s+a)}return n._maxage=a,n};const l=/^Failed to fetch|^NetworkError|^Could not connect/;function p(t){const e=performance.timeOrigin;for(const s of t){const t=c(yt(s.name));if(t.reqNum++,t.lastDoneTime=e+s.responseEnd,s.responseStart>0){const e=s.responseStart-s.requestStart;t.reqTimeSum+=e,t.reqTimeAvg=t.reqTimeSum/t.reqNum}}}t.init=async function(){await e.open({cache:{keyPath:"url"}});const t=ft();await e.enum("cache",(s=>{s.expire<t?e.delete("cache",s.url):n.set(s.url,s)})),p(performance.getEntriesByType("resource")),new PerformanceObserver((t=>{p(t.getEntries())})).observe({entryTypes:["resource"]})},t.parseWeightConf=function(t){const e=navigator.language.toLowerCase(),s=e.split("-")[0],n=t.getParams("@weight "+e)||t.getParams("@weight "+s)||t.getParams("@weight");if(!n){const t=kt[e]||kt["*"];return new Map(Object.entries(t))}const i=new Map;for(const[t,e]of n){const s=+e;isNaN(s)||i.set(t,s)}return i}}(X||(X={}));class st extends Error{constructor(t){super(t)}}class nt{constructor(){this.chunks=[],this.offset=0,this.availLen=0}async pull(t){do{let t;try{const{value:e}=await this.source.read();t=e}catch(t){throw new st(t.message)}if(!t)return!1;this.feed(t)}while(this.availLen<t);return!0}feed(t){this.chunks.push(t),this.availLen+=t.length}readBytesSync(t){let e;this.availLen-=t;let s=0,n=0;if(this.offset){const i=this.chunks[0],a=this.offset+t,r=i.subarray(this.offset,a);if(a<i.length)return this.offset+=t,r;if(this.offset=0,a===i.length)return this.chunks.shift(),r;e=new Uint8Array(t),e.set(r,0),s=r.length,n=1}else e=new Uint8Array(t);do{const i=this.chunks[n],a=s+i.length,r=a-t;if(r>0){const t=i.subarray(0,-r);e.set(t,s),this.offset=t.length;break}e.set(i,s),s=a,n++}while(s<t);return this.chunks.splice(0,n),e}async readBytesAsync(t){return this.availLen<t&&await this.pull(t),this.readBytesSync(t)}readU32Sync(){let t=this.offset,e=this.chunks[0];return e.length-t>4?(this.offset+=4,this.availLen-=4):(e=this.readBytesSync(4),t=0),(e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t])>>>0}readU16Sync(){let t=this.offset,e=this.chunks[0];return e.length-t>2?(this.offset+=2,this.availLen-=2):(e=this.readBytesSync(2),t=0),e[t+1]<<8|e[t]}readU8Sync(){let t=this.offset,e=this.chunks[0];return e.length-t>1?(this.offset+=1,this.availLen-=1):(e=this.readBytesSync(1),t=0),e[t]}async readU32Async(){return this.availLen<4&&await this.pull(4),this.readU16Sync()}async readU16Async(){return this.availLen<2&&await this.pull(2),this.readU16Sync()}async readU8Async(){return this.availLen<1&&await this.pull(1),this.readU8Sync()}async findAsync(t){if(this.offset){const e=this.chunks[0].indexOf(t,this.offset);if(-1!==e)return e-this.offset}let e=this.offset,s=0;for(;;){let n=this.chunks[s];if(!n){if(!await this.pull(1))break;n=this.chunks[s]}const i=n.indexOf(t);if(-1!==i)return e+i;e+=n.length,s++}return-1}}const it=new TextEncoder,at=new TextDecoder;function rt(t){return at.decode(t)}function ot(t){return btoa(function(t){return t.reduce(((t,e)=>t+String.fromCharCode(e)),"")}(t))}function ct(t){try{t=atob(t)}catch{return}const e=new Uint8Array(t.length);for(let s=0;s<e.length;s++)e[s]=t.charCodeAt(s);return e}function lt(t){try{return JSON.parse(t)}catch{}}function pt(t){return(t=t.trim())?t.split(/\s+/):[]}function ht(t){if('"'===t[0]){if(void 0===(t=lt(t)))return;return function(t){return it.encode(t)}(t)}return ct(t)}const ut={"":1,ms:1,s:1e3,min:6e4,h:36e5,d:864e5,y:31536e6};function dt(t){const e=t.match(/^([\d.]{1,9})(y|d|h|min|s|ms|)$/);if(!e)return NaN;const[,s,n]=e;return+s*ut[n]}function mt(t){const e=t.match(/^([\d.]{1,9})(k|K|M|G|)(i|)(b|B|)$/);if(!e)return NaN;const[,s,n,i,a]=e;return+s*(i?1024:1e3)**("k"===n||"K"===n?1:"M"===n?2:"G"===n?3:0)/("b"===a?8:1)}function ft(){return Date.now()/1e3|0}function gt(t,e=0){if(0===e)for(const s of t)e+=s.length;const s=new Uint8Array(e);let n=0;for(const e of t)s.set(e,n),n+=e.length;return s}function xt(t,e){if(t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(t[s]!==e[s])return!1;return!0}function wt(t,e){const s=t.indexOf(e);return-1===s?[t]:[t.substring(0,s),t.substring(s+e.length)]}function bt(t,e){for(const[s,n]of e)t.set(s,n)}function yt(t){return t.match(/^https?:\/\/([^/]+)/)[1]}function vt(t){return t.startsWith(i)?t.substring(n.length):t}async function jt(t){const e=await l.digest("SHA-256",t);return new Uint8Array(e)}const kt={"zh-cn":{"ajax.cdnjs.com":50,"cdnjs.cloudflare.com":50,"cdn.jsdelivr.net":80,"raw.githubusercontent.com":10,"cdnjs.loli.net":70,"lib.baomitu.com":80,"lf6-cdn-tos.bytecdntp.com":90,"cdn.staticfile.org":90,"cdn.bootcss.com":10,"cdn.bootcdn.net":80,"unpkg.com":50,"g.alicdn.com":90,"pagecdn.io":20,"ajax.aspnetcdn.com":60,"ajax.googleapis.com":10,"code.jquery.com":20,"stackpath.bootstrapcdn.com":30,"maxcdn.bootstrapcdn.com":30,"cdn.datatables.net":40,"twemoji.maxcdn.com":40},"*":{"ajax.cdnjs.com":90,"cdnjs.cloudflare.com":90,"cdn.jsdelivr.net":40,"raw.githubusercontent.com":10,"cdnjs.loli.net":40,"lib.baomitu.com":20,"lf6-cdn-tos.bytecdntp.com":40,"cdn.staticfile.org":20,"cdn.bootcss.com":10,"cdn.bootcdn.net":20,"unpkg.com":40,"g.alicdn.com":30,"pagecdn.io":40,"ajax.aspnetcdn.com":70,"ajax.googleapis.com":90,"code.jquery.com":50,"stackpath.bootstrapcdn.com":40,"maxcdn.bootstrapcdn.com":50,"cdn.datatables.net":50,"twemoji.maxcdn.com":50}}}();
//# sourceMappingURL=https://unpkg.com/freecdn-js@0.4.1/dist/freecdn-main.min.js.map
